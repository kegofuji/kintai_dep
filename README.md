# 勤怠管理システム

社内向けの勤怠・有給申請を扱う Spring Boot ベースの Web アプリケーションです。ログイン後は SPA（静的ファイル）で勤怠入力・履歴閲覧・管理者承認などを行います。

## 主な機能

### 基本勤怠機能
- **出退勤打刻**: リアルタイムでの出勤・退勤時刻記録
- **勤怠履歴表示**: 日別・月別の勤怠記録閲覧（カレンダー表示対応）
- **勤務時間計算**: 自動的な勤務時間・残業時間・深夜勤務時間の算出
- **遅刻・早退・欠勤管理**: 勤怠ステータスの自動判定と記録

### 申請・承認機能
- **有給申請**: 期間指定での有給休暇申請（休日自動除外）
- **有給承認フロー**: 管理者による申請の承認・却下処理
- **打刻修正申請**: 勤怠記録の修正申請と管理者承認
- **月次申請**: 月単位での勤怠申請と承認機能

### 管理者機能
- **従業員管理**: 社員一覧表示と基本情報管理
- **勤怠承認**: 月次勤怠の一括承認処理
- **申請管理**: 未承認の有給申請・修正申請の一覧表示と処理

### セキュリティ機能
- **認証・認可**: セッション管理によるユーザー認証
- **CSRF保護**: クロスサイトリクエストフォージェリ対策
- **権限管理**: 一般ユーザーと管理者の権限分離

## 技術スタック

### バックエンド
- **Java 17** / **Spring Boot 3.2.x**
- **Spring Security** (認証・認可)
- **Spring Data JPA** (データアクセス)
- **MySQL 8.x** (本番環境) / **H2** (開発環境)
- **Flyway** (データベースマイグレーション)

### フロントエンド
- **Vanilla JavaScript** (ES6+)
- **Bootstrap 5** (UI フレームワーク)
- **SPA (Single Page Application)** アーキテクチャ

### 開発・運用
- **Maven** (ビルドツール)
- **Docker** (コンテナ化)
- **Render** (デプロイプラットフォーム)

## ローカル開発環境

```bash
# 依存関係の取得とテスト
mvn clean test

# 開発プロファイルで起動（H2 メモリ DB）
mvn spring-boot:run

# ブラウザで http://localhost:8080/login を開く
```

MySQL を使用したい場合は `SPRING_PROFILES_ACTIVE=prod` および `DATABASE_URL` / `DB_USERNAME` / `DB_PASSWORD` を環境変数で指定してください。

## デプロイ

Render を利用したデプロイ手順を `RENDER_DEPLOYMENT.md` にまとめています。CI/CD は Render の自動デプロイ（GitHub 連携）を想定しています。

## データベース設計

### 主要テーブル
- **employees**: 従業員情報（従業員ID、コード、基準休暇日数など）
- **attendance_records**: 勤怠記録（出退勤時刻、遅刻・早退・残業時間等）
- **leave_requests**: 休暇申請（休暇種別、期間、取得単位、承認状況等）
- **leave_balances**: 休暇残数（種別ごとの総日数・使用日数・残日数）
- **leave_grants**: 休暇付与履歴（付与日数、対象期間、付与者等）
- **adjustment_requests**: 打刻修正申請（修正内容、理由、承認状況等）
- **approvals**: 承認履歴（対象種別、対象ID、承認者、コメント等）
- **user_accounts**: ユーザーアカウント（ログイン認証用）
- **admins**: 管理者アカウント

### 勤怠ステータス
- **NORMAL**: 正常勤務
- **LATE**: 遅刻
- **EARLY_LEAVE**: 早退
- **LATE_AND_EARLY_LEAVE**: 遅刻・早退
- **OVERTIME**: 残業
- **NIGHT_SHIFT**: 深夜勤務
- **ABSENT**: 欠勤

## ディレクトリ構成

| パス | 説明 |
| --- | --- |
| `src/main/java/com/kintai/` | Spring Boot アプリケーションコード |
| `├── controller/` | REST API コントローラー |
| `├── service/` | ビジネスロジック層 |
| `├── entity/` | JPA エンティティ |
| `├── repository/` | データアクセス層 |
| `├── dto/` | データ転送オブジェクト |
| `└── util/` | ユーティリティクラス |
| `src/main/resources/` | 設定ファイル・静的リソース |
| `├── static/` | SPA の HTML / JS / CSS |
| `├── db/migration/` | Flyway マイグレーションスクリプト |
| `└── application*.yml` | プロファイル別設定 |
| `scripts/` | 運用向けスクリプト |

## 今後の機能拡張予定

### 休暇管理の拡張
- **AM/PM休**: 午前・午後の半日休暇申請
- **特別休暇**: 慶弔休暇、育児休暇等の特別な休暇種別
- **休暇種別管理**: 各休暇の日数制限・申請ルール設定

### 勤務パターン管理
- **勤務パターン変更申請**: フレックス勤務、時差出勤等の申請
- **社員ごとの勤務時間切替**: 個人別の勤務時間設定
- **休憩時間管理**: 休憩時間の記録・集計

### 休日出勤・代休管理
- **休日出勤申請**: 休日勤務の事前申請
- **代休・振休管理**: 休日出勤に対する代休・振休の付与
- **休日勤務時間集計**: 休日勤務の時間管理

### その他の拡張機能
- **通知機能**: 申請・承認の通知システム
- **モバイル対応**: スマートフォンでの利用最適化

## ライセンス

社内利用を想定しているため、必要に応じて確認してください。

